angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window",function(a,b){return{restrict:"A",scope:{ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"="},compile:function(c,d,e){return function(c,d,e){function f(a){var b=0;return angular.forEach(a.parent().children(),function(c){c!=a[0]&&(b+=c.clientHeight)}),a.parent()[0].clientHeight-b}function g(){var a=c.ngBind||c.ngBindHtml;if(a){var b=0,g="undefined"!=typeof e.ellipsisSymbol?e.ellipsisSymbol:"&hellip;",i="undefined"!=typeof c.ellipsisSeparator?e.ellipsisSeparator:" ",j="undefined"!=typeof c.ellipsisSeparatorReg?c.ellipsisSeparatorReg:!1,k="undefined"!=typeof c.ellipsisAppend&&""!==c.ellipsisAppend?g+"<span>"+c.ellipsisAppend+"</span>":g,l=j?a.match(j):a.split(i);if(e.isTruncated=!1,d.html(a),h(d,c.useParent)){var m=l.length,n=c.useParent?f(d):d[0].clientHeight,o=parseInt(d.css("max-height"),10)||parseInt(e.maxHeight,10)||0;for(o&&o>n&&(n=o,d.css("height",o+"px")),d.html(a+k),d.attr("data-overflowed","true");m>b;b++)if(l.pop(),d.html(l.join(i)+k),(c.useParent?d.parent()[0]:d[0]).scrollHeight<n||h(d,c.useParent)===!1){e.isTruncated=!0;break}g!=k&&"undefined"!=typeof c.ellipsisAppendClick&&""!==c.ellipsisAppendClick&&d.find("span").bind("click",function(a){c.$apply(function(){c.ellipsisAppendClick.call(c,{event:a})})})}}}function h(a,b){return a=b?a.parent():a,a[0].scrollHeight>a[0].clientHeight}function i(){a.cancel(e.lastWindowTimeoutEvent),e.lastWindowTimeoutEvent=a(function(){(e.lastWindowResizeWidth!=window.innerWidth||e.lastWindowResizeHeight!=window.innerHeight)&&g(),e.lastWindowResizeWidth=window.innerWidth,e.lastWindowResizeHeight=window.innerHeight},75)}e.lastWindowResizeTime=0,e.lastWindowResizeWidth=0,e.lastWindowResizeHeight=0,e.lastWindowTimeoutEvent=null,e.isTruncated=!1,c.$watch("ngBind",function(){a(function(){g()})}),c.$watch("ngBindHtml",function(){a(function(){g()})}),c.$watch("ellipsisAppend",function(){g()});var j=angular.element(b);j.bind("resize",i),c.$on("$destroy",function(){j.unbind("resize",i)})}}}}]);